
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Encryption Library - CodeIgniter 3 - W3cubDocs</title>
  
  <meta name="description" content=" Important ">
  <meta name="keywords" content="encryption, library, -, codeigniter, codeigniter~3">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/codeigniter~3/libraries/encryption/">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" integrity="sha256-6/DH7X+2hvUPElJfGsvzm+tgIpmM9zjbYxnpsr6gR1A=" crossorigin="anonymous" href="/assets/application-ebf0c7ed7fb686f50f12525f1acbf39beb6022998cf738db6319e9b2bea04750.css">
  <script type="text/javascript" src="/assets/application-db285287b40ed28fac520fcfd75d7d874692b647b5b5e05968c741dda5de4148.js" integrity="sha256-2yhSh7QO0o+sUg/P1119h0aStke1teBZaMdB3aXeQUg=" crossorigin="anonymous"></script>
  <script src="/json/codeigniter~3.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-2572770204602497",
            enable_page_level_ads: true
        });
  </script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/codeigniter~3/" class="_nav-link" title="" style="margin-left:0;">CodeIgniter 3</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _sphinx">
				
				
<h1 id="encryption-library">Encryption Library</h1> <div class="admonition important"> <p class="first admonition-title">Important</p> <p class="last">DO NOT use this or any other <em>encryption</em> library for user password storage! Passwords must be <em>hashed</em> instead, and you should do that via PHP’s own <a class="reference external" href="http://php.net/password" target="_blank">Password Hashing extension</a>.</p> </div> <p>The Encryption Library provides two-way data encryption. To do so in a cryptographically secure way, it utilizes PHP extensions that are unfortunately not always available on all systems. You must meet one of the following dependencies in order to use this library:</p> <ul class="simple"> <li><a class="reference external" href="http://php.net/openssl" target="_blank">OpenSSL</a></li> <li>
<a class="reference external" href="http://php.net/mcrypt" target="_blank">MCrypt</a> (and <code>MCRYPT_DEV_URANDOM</code> availability)</li> </ul> <p>If neither of the above dependencies is met, we simply cannot offer you a good enough implementation to meet the high standards required for proper cryptography.</p>  <ul class="simple"> <li>
<a class="reference internal" href="#using-the-encryption-library" id="id2">Using the Encryption Library</a><ul> <li><a class="reference internal" href="#initializing-the-class" id="id3">Initializing the Class</a></li> <li><a class="reference internal" href="#default-behavior" id="id4">Default behavior</a></li> <li><a class="reference internal" href="#setting-your-encryption-key" id="id5">Setting your encryption_key</a></li> <li>
<a class="reference internal" href="#supported-encryption-ciphers-and-modes" id="id6">Supported encryption ciphers and modes</a><ul> <li><a class="reference internal" href="#portable-ciphers" id="id7">Portable ciphers</a></li> <li><a class="reference internal" href="#driver-specific-ciphers" id="id8">Driver-specific ciphers</a></li> <li><a class="reference internal" href="#encryption-modes" id="id9">Encryption modes</a></li> </ul> </li> <li><a class="reference internal" href="#message-length" id="id10">Message Length</a></li> <li><a class="reference internal" href="#configuring-the-library" id="id11">Configuring the library</a></li> <li>
<a class="reference internal" href="#encrypting-and-decrypting-data" id="id12">Encrypting and decrypting data</a><ul> <li><a class="reference internal" href="#how-it-works" id="id13">How it works</a></li> <li><a class="reference internal" href="#using-custom-parameters" id="id14">Using custom parameters</a></li> <li><a class="reference internal" href="#supported-hmac-authentication-algorithms" id="id15">Supported HMAC authentication algorithms</a></li> </ul> </li> </ul> </li> <li><a class="reference internal" href="#class-reference" id="id16">Class Reference</a></li> </ul>   <h2 id="using-the-encryption-library">Using the Encryption Library</h2>  <h3 id="initializing-the-class">Initializing the Class</h3> <p>Like most other classes in CodeIgniter, the Encryption library is initialized in your controller using the <code>$this-&gt;load-&gt;library()</code> method:</p> <pre data-language="php">$this-&gt;load-&gt;library('encryption');
</pre> <p>Once loaded, the Encryption library object will be available using:</p> <pre data-language="php">$this-&gt;encryption
</pre>   <h3 id="default-behavior">Default behavior</h3> <p>By default, the Encryption Library will use the AES-128 cipher in CBC mode, using your configured <em>encryption_key</em> and SHA512 HMAC authentication.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">AES-128 is chosen both because it is proven to be strong and because of its wide availability across different cryptographic software and programming languages’ APIs.</p> </div> <p>However, the <em>encryption_key</em> is not used as is.</p> <p>If you are somewhat familiar with cryptography, you should already know that a HMAC also requires a secret key and using the same key for both encryption and authentication is a bad practice.</p> <p>Because of that, two separate keys are derived from your already configured <em>encryption_key</em>: one for encryption and one for authentication. This is done via a technique called <a class="reference external" href="http://en.wikipedia.org/wiki/HKDF" target="_blank">HMAC-based Key Derivation Function</a> (HKDF).</p>   <h3 id="setting-your-encryption-key">Setting your encryption_key</h3> <p>An <em>encryption key</em> is a piece of information that controls the cryptographic process and permits a plain-text string to be encrypted, and afterwards - decrypted. It is the secret “ingredient” in the whole process that allows you to be the only one who is able to decrypt data that you’ve decided to hide from the eyes of the public. After one key is used to encrypt data, that same key provides the <strong>only</strong> means to decrypt it, so not only must you chose one carefully, but you must not lose it or you will also lose access to the data.</p> <p>It must be noted that to ensure maximum security, such key <em>should</em> not only be as strong as possible, but also often changed. Such behavior however is rarely practical or possible to implement, and that is why CodeIgniter gives you the ability to configure a single key that is to be used (almost) every time.</p> <p>It goes without saying that you should guard your key carefully. Should someone gain access to your key, the data will be easily decrypted. If your server is not totally under your control it’s impossible to ensure key security so you may want to think carefully before using it for anything that requires high security, like storing credit card numbers.</p> <p>Your encryption key <strong>must</strong> be as long as the encyption algorithm in use allows. For AES-128, that’s 128 bits or 16 bytes (charcters) long. You will find a table below that shows the supported key lengths of different ciphers.</p> <p>The key should be as random as possible and it <strong>must not</strong> be a regular text string, nor the output of a hashing function, etc. In order to create a proper key, you must use the Encryption library’s <code>create_key()</code> method</p> <pre data-language="php">// $key will be assigned a 16-byte (128-bit) random key
$key = $this-&gt;encryption-&gt;create_key(16);
</pre> <p>The key can be either stored in your <em>application/config/config.php</em>, or you can design your own storage mechanism and pass the key dynamically when encrypting/decrypting.</p> <p>To save your key to your <em>application/config/config.php</em>, open the file and set:</p> <pre data-language="php">$config['encryption_key'] = 'YOUR KEY';
</pre> <p>You’ll notice that the <code>create_key()</code> method outputs binary data, which is hard to deal with (i.e. a copy-paste may damage it), so you may use <code>bin2hex()</code>, <code>hex2bin()</code> or Base64-encoding to work with the key in a more friendly manner. For example:</p> <pre data-language="php">// Get a hex-encoded representation of the key:
$key = bin2hex($this-&gt;encryption-&gt;create_key(16));

// Put the same value in your config with hex2bin(),
// so that it is still passed as binary to the library:
$config['encryption_key'] = hex2bin(&lt;your hex-encoded key&gt;);
</pre>   <h3 id="ciphers-and-modes">Supported encryption ciphers and modes</h3> <div class="admonition note" id="supported-encryption-ciphers-and-modes"> <p class="first admonition-title">Note</p> <p class="last">The terms ‘cipher’ and ‘encryption algorithm’ are interchangeable.</p> </div>  <h4 id="portable-ciphers">Portable ciphers</h4> <p>Because MCrypt and OpenSSL (also called drivers throughout this document) each support different sets of encryption algorithms and often implement them in different ways, our Encryption library is designed to use them in a portable fashion, or in other words - it enables you to use them interchangeably, at least for the ciphers supported by both drivers.</p> <p>It is also implemented in a way that aims to match the standard implementations in other programming languages and libraries.</p> <p>Here’s a list of the so called “portable” ciphers, where “CodeIgniter name” is the string value that you’d have to pass to the Encryption library to use that cipher:</p> <table class="docutils">  <thead valign="bottom"> <tr>
<th class="head">Cipher name</th> <th class="head">CodeIgniter name</th> <th class="head">Key lengths (bits / bytes)</th> <th class="head">Supported modes</th> </tr> </thead>  <tr>
<td>AES-128 / Rijndael-128</td> <td>aes-128</td> <td>128 / 16</td> <td>CBC, CTR, CFB, CFB8, OFB, ECB</td> </tr> <tr>
<td>AES-192</td> <td>aes-192</td> <td>192 / 24</td> <td>CBC, CTR, CFB, CFB8, OFB, ECB</td> </tr> <tr>
<td>AES-256</td> <td>aes-256</td> <td>256 / 32</td> <td>CBC, CTR, CFB, CFB8, OFB, ECB</td> </tr> <tr>
<td>DES</td> <td>des</td> <td>56 / 7</td> <td>CBC, CFB, CFB8, OFB, ECB</td> </tr> <tr>
<td>TripleDES</td> <td>tripledes</td> <td>56 / 7, 112 / 14, 168 / 21</td> <td>CBC, CFB, CFB8, OFB</td> </tr> <tr>
<td>Blowfish</td> <td>blowfish</td> <td>128-448 / 16-56</td> <td>CBC, CFB, OFB, ECB</td> </tr> <tr>
<td>CAST5 / CAST-128</td> <td>cast5</td> <td>88-128 / 11-16</td> <td>CBC, CFB, OFB, ECB</td> </tr> <tr>
<td>RC4 / ARCFour</td> <td>rc4</td> <td>40-2048 / 5-256</td> <td>Stream</td> </tr>  </table> <div class="admonition important"> <p class="first admonition-title">Important</p> <p class="last">Because of how MCrypt works, if you fail to provide a key with the appropriate length, you might end up using a different algorithm than the one configured, so be really careful with that!</p> </div> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">In case it isn’t clear from the above table, Blowfish, CAST5 and RC4 support variable length keys. That is, any number in the shown ranges is valid, although in bit terms that only happens in 8-bit increments.</p> </div> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Even though CAST5 supports key lengths lower than 128 bits (16 bytes), in fact they will just be zero-padded to the maximum length, as specified in <a class="reference external" href="http://tools.ietf.org/rfc/rfc2144.txt" target="_blank">RFC 2144</a>.</p> </div> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Blowfish supports key lengths as small as 32 bits (4 bytes), but our tests have shown that only lengths of 128 bits (16 bytes) or higher are properly supported by both MCrypt and OpenSSL. It is also a bad practice to use such low-length keys anyway.</p> </div>   <h4 id="driver-specific-ciphers">Driver-specific ciphers</h4> <p>As noted above, MCrypt and OpenSSL support different sets of encryption ciphers. For portability reasons and because we haven’t tested them properly, we do not advise you to use the ones that are driver-specific, but regardless, here’s a list of most of them:</p> <table class="docutils">  <thead valign="bottom"> <tr>
<th class="head">Cipher name</th> <th class="head">Driver</th> <th class="head">Key lengths (bits / bytes)</th> <th class="head">Supported modes</th> </tr> </thead>  <tr>
<td>AES-128</td> <td>OpenSSL</td> <td>128 / 16</td> <td>CBC, CTR, CFB, CFB8, OFB, ECB, XTS</td> </tr> <tr>
<td>AES-192</td> <td>OpenSSL</td> <td>192 / 24</td> <td>CBC, CTR, CFB, CFB8, OFB, ECB, XTS</td> </tr> <tr>
<td>AES-256</td> <td>OpenSSL</td> <td>256 / 32</td> <td>CBC, CTR, CFB, CFB8, OFB, ECB, XTS</td> </tr> <tr>
<td>Rijndael-128</td> <td>MCrypt</td> <td>128 / 16, 192 / 24, 256 / 32</td> <td>CBC, CTR, CFB, CFB8, OFB, OFB8, ECB</td> </tr> <tr>
<td>Rijndael-192</td> <td>MCrypt</td> <td>128 / 16, 192 / 24, 256 / 32</td> <td>CBC, CTR, CFB, CFB8, OFB, OFB8, ECB</td> </tr> <tr>
<td>Rijndael-256</td> <td>MCrypt</td> <td>128 / 16, 192 / 24, 256 / 32</td> <td>CBC, CTR, CFB, CFB8, OFB, OFB8, ECB</td> </tr> <tr>
<td>GOST</td> <td>MCrypt</td> <td>256 / 32</td> <td>CBC, CTR, CFB, CFB8, OFB, OFB8, ECB</td> </tr> <tr>
<td>Twofish</td> <td>MCrypt</td> <td>128 / 16, 192 / 24, 256 / 32</td> <td>CBC, CTR, CFB, CFB8, OFB, OFB8, ECB</td> </tr> <tr>
<td>CAST-128</td> <td>MCrypt</td> <td>40-128 / 5-16</td> <td>CBC, CTR, CFB, CFB8, OFB, OFB8, ECB</td> </tr> <tr>
<td>CAST-256</td> <td>MCrypt</td> <td>128 / 16, 192 / 24, 256 / 32</td> <td>CBC, CTR, CFB, CFB8, OFB, OFB8, ECB</td> </tr> <tr>
<td>Loki97</td> <td>MCrypt</td> <td>128 / 16, 192 / 24, 256 / 32</td> <td>CBC, CTR, CFB, CFB8, OFB, OFB8, ECB</td> </tr> <tr>
<td>SaferPlus</td> <td>MCrypt</td> <td>128 / 16, 192 / 24, 256 / 32</td> <td>CBC, CTR, CFB, CFB8, OFB, OFB8, ECB</td> </tr> <tr>
<td>Serpent</td> <td>MCrypt</td> <td>128 / 16, 192 / 24, 256 / 32</td> <td>CBC, CTR, CFB, CFB8, OFB, OFB8, ECB</td> </tr> <tr>
<td>XTEA</td> <td>MCrypt</td> <td>128 / 16</td> <td>CBC, CTR, CFB, CFB8, OFB, OFB8, ECB</td> </tr> <tr>
<td>RC2</td> <td>MCrypt</td> <td>8-1024 / 1-128</td> <td>CBC, CTR, CFB, CFB8, OFB, OFB8, ECB</td> </tr> <tr>
<td>RC2</td> <td>OpenSSL</td> <td>8-1024 / 1-128</td> <td>CBC, CFB, OFB, ECB</td> </tr> <tr>
<td>Camellia-128</td> <td>OpenSSL</td> <td>128 / 16</td> <td>CBC, CFB, CFB8, OFB, ECB</td> </tr> <tr>
<td>Camellia-192</td> <td>OpenSSL</td> <td>192 / 24</td> <td>CBC, CFB, CFB8, OFB, ECB</td> </tr> <tr>
<td>Camellia-256</td> <td>OpenSSL</td> <td>256 / 32</td> <td>CBC, CFB, CFB8, OFB, ECB</td> </tr> <tr>
<td>Seed</td> <td>OpenSSL</td> <td>128 / 16</td> <td>CBC, CFB, OFB, ECB</td> </tr>  </table> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">If you wish to use one of those ciphers, you’d have to pass its name in lower-case to the Encryption library.</p> </div> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">You’ve probably noticed that all AES cipers (and Rijndael-128) are also listed in the portable ciphers list. This is because drivers support different modes for these ciphers. Also, it is important to note that AES-128 and Rijndael-128 are actually the same cipher, but <strong>only</strong> when used with a 128-bit key.</p> </div> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">CAST-128 / CAST-5 is also listed in both the portable and driver-specific ciphers list. This is because OpenSSL’s implementation doesn’t appear to be working correctly with key sizes of 80 bits and lower.</p> </div> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">RC2 is listed as supported by both MCrypt and OpenSSL. However, both drivers implement them differently and they are not portable. It is probably worth noting that we only found one obscure source confirming that it is MCrypt that is not properly implementing it.</p> </div>   <h4 id="id1">Encryption modes</h4> <p id="encryption-modes">Different modes of encryption have different characteristics and serve for different purposes. Some are stronger than others, some are faster and some offer extra features. We are not going in depth into that here, we’ll leave that to the cryptography experts. The table below is to provide brief informational reference to our more experienced users. If you are a beginner, just stick to the CBC mode - it is widely accepted as strong and secure for general purposes.</p> <table class="docutils">  <thead valign="bottom"> <tr>
<th class="head">Mode name</th> <th class="head">CodeIgniter name</th> <th class="head">Driver support</th> <th class="head">Additional info</th> </tr> </thead>  <tr>
<td>CBC</td> <td>cbc</td> <td>MCrypt, OpenSSL</td> <td>A safe default choice</td> </tr> <tr>
<td>CTR</td> <td>ctr</td> <td>MCrypt, OpenSSL</td> <td>Considered as theoretically better than CBC, but not as widely available</td> </tr> <tr>
<td>CFB</td> <td>cfb</td> <td>MCrypt, OpenSSL</td> <td>N/A</td> </tr> <tr>
<td>CFB8</td> <td>cfb8</td> <td>MCrypt, OpenSSL</td> <td>Same as CFB, but operates in 8-bit mode (not recommended).</td> </tr> <tr>
<td>OFB</td> <td>ofb</td> <td>MCrypt, OpenSSL</td> <td>N/A</td> </tr> <tr>
<td>OFB8</td> <td>ofb8</td> <td>MCrypt</td> <td>Same as OFB, but operates in 8-bit mode (not recommended).</td> </tr> <tr>
<td>ECB</td> <td>ecb</td> <td>MCrypt, OpenSSL</td> <td>Ignores IV (not recommended).</td> </tr> <tr>
<td>XTS</td> <td>xts</td> <td>OpenSSL</td> <td>Usually used for encrypting random access data such as RAM or hard-disk storage.</td> </tr> <tr>
<td>Stream</td> <td>stream</td> <td>MCrypt, OpenSSL</td> <td>This is not actually a mode, it just says that a stream cipher is being used. Required because of the general cipher+mode initialization process.</td> </tr>  </table>    <h3 id="message-length">Message Length</h3> <p>It’s probably important for you to know that an encrypted string is usually longer than the original, plain-text string (depending on the cipher).</p> <p>This is influenced by the cipher algorithm itself, the IV prepended to the cipher-text and the HMAC authentication message that is also prepended. Furthermore, the encrypted message is also Base64-encoded so that it is safe for storage and transmission, regardless of a possible character set in use.</p> <p>Keep this information in mind when selecting your data storage mechanism. Cookies, for example, can only hold 4K of information.</p>   <h3 id="configuration">Configuring the library</h3> <p id="configuring-the-library">For usability, performance, but also historical reasons tied to our old <a class="reference internal" href="../encrypt/"><span class="doc">Encrypt Class</span></a>, the Encryption library is designed to use repeatedly the same driver, encryption cipher, mode and key.</p> <p>As noted in the “Default behavior” section above, this means using an auto-detected driver (OpenSSL has a higher priority), the AES-128 ciper in CBC mode, and your <code>$config['encryption_key']</code> value.</p> <p>If you wish to change that however, you need to use the <code>initialize()</code> method. It accepts an associative array of parameters, all of which are optional:</p> <table class="docutils">  <thead valign="bottom"> <tr>
<th class="head">Option</th> <th class="head">Possible values</th> </tr> </thead>  <tr>
<td>driver</td> <td>‘mcrypt’, ‘openssl’</td> </tr> <tr>
<td>cipher</td> <td>Cipher name (see <a class="reference internal" href="#ciphers-and-modes"><span class="std std-ref">Supported encryption ciphers and modes</span></a>)</td> </tr> <tr>
<td>mode</td> <td>Encryption mode (see <a class="reference internal" href="#encryption-modes"><span class="std std-ref">Encryption modes</span></a>)</td> </tr> <tr>
<td>key</td> <td>Encryption key</td> </tr>  </table> <p>For example, if you were to change the encryption algorithm and mode to AES-256 in CTR mode, this is what you should do:</p> <pre data-language="php">$this-&gt;encryption-&gt;initialize(
        array(
                'cipher' =&gt; 'aes-256',
                'mode' =&gt; 'ctr',
                'key' =&gt; '&lt;a 32-character random string&gt;'
        )
);
</pre> <p>Note that we only mentioned that you want to change the ciper and mode, but we also included a key in the example. As previously noted, it is important that you choose a key with a proper size for the used algorithm.</p> <p>There’s also the ability to change the driver, if for some reason you have both, but want to use MCrypt instead of OpenSSL:</p> <pre data-language="php">// Switch to the MCrypt driver
$this-&gt;encryption-&gt;initialize(array('driver' =&gt; 'mcrypt'));

// Switch back to the OpenSSL driver
$this-&gt;encryption-&gt;initialize(array('driver' =&gt; 'openssl'));
</pre>   <h3 id="encrypting-and-decrypting-data">Encrypting and decrypting data</h3> <p>Encrypting and decrypting data with the already configured library settings is simple. As simple as just passing the string to the <code>encrypt()</code> and/or <code>decrypt()</code> methods:</p> <pre data-language="php">$plain_text = 'This is a plain-text message!';
$ciphertext = $this-&gt;encryption-&gt;encrypt($plain_text);

// Outputs: This is a plain-text message!
echo $this-&gt;encryption-&gt;decrypt($ciphertext);
</pre> <p>And that’s it! The Encryption library will do everything necessary for the whole process to be cryptographically secure out-of-the-box. You don’t need to worry about it.</p> <div class="admonition important"> <p class="first admonition-title">Important</p> <p class="last">Both methods will return FALSE in case of an error. While for <code>encrypt()</code> this can only mean incorrect configuration, you should always check the return value of <code>decrypt()</code> in production code.</p> </div>  <h4 id="how-it-works">How it works</h4> <p>If you must know how the process works, here’s what happens under the hood:</p> <ul class="simple"> <li>
<code>$this-&gt;encryption-&gt;encrypt($plain_text)</code><ol class="arabic"> <li>Derive an encryption key and a HMAC key from your configured <em>encryption_key</em> via HKDF, using the SHA-512 digest algorithm.</li> <li>Generate a random initialization vector (IV).</li> <li>Encrypt the data via AES-128 in CBC mode (or another previously configured cipher and mode), using the above-mentioned derived encryption key and IV.</li> <li>Prepend said IV to the resulting cipher-text.</li> <li>Base64-encode the resulting string, so that it can be safely stored or transferred without worrying about character sets.</li> <li>Create a SHA-512 HMAC authentication message using the derived HMAC key to ensure data integrity and prepend it to the Base64 string.</li> </ol> </li> <li>
<code>$this-&gt;encryption-&gt;decrypt($ciphertext)</code><ol class="arabic"> <li>Derive an encryption key and a HMAC key from your configured <em>encryption_key</em> via HKDF, using the SHA-512 digest algorithm. Because your configured <em>encryption_key</em> is the same, this will produce the same result as in the <code>encrypt()</code> method above - otherwise you won’t be able to decrypt it.</li> <li>Check if the string is long enough, separate the HMAC out of it and validate if it is correct (this is done in a way that prevents timing attacks against it). Return FALSE if either of the checks fails.</li> <li>Base64-decode the string.</li> <li>Separate the IV out of the cipher-text and decrypt the said cipher-text using that IV and the derived encryption key.</li> </ol> </li> </ul>   <h4 id="custom-parameters">Using custom parameters</h4> <p id="using-custom-parameters">Let’s say you have to interact with another system that is out of your control and uses another method to encrypt data. A method that will most certainly not match the above-described sequence and probably not use all of the steps either.</p> <p>The Encryption library allows you to change how its encryption and decryption processes work, so that you can easily tailor a custom solution for such situations.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">It is possible to use the library in this way, without setting an <em>encryption_key</em> in your configuration file.</p> </div> <p>All you have to do is to pass an associative array with a few parameters to either the <code>encrypt()</code> or <code>decrypt()</code> method. Here’s an example:</p> <pre data-language="php">// Assume that we have $ciphertext, $key and $hmac_key
// from on outside source

$message = $this-&gt;encryption-&gt;decrypt(
        $ciphertext,
        array(
                'cipher' =&gt; 'blowfish',
                'mode' =&gt; 'cbc',
                'key' =&gt; $key,
                'hmac_digest' =&gt; 'sha256',
                'hmac_key' =&gt; $hmac_key
        )
);
</pre> <p>In the above example, we are decrypting a message that was encrypted using the Blowfish cipher in CBC mode and authenticated via a SHA-256 HMAC.</p> <div class="admonition important"> <p class="first admonition-title">Important</p> <p class="last">Note that both ‘key’ and ‘hmac_key’ are used in this example. When using custom parameters, encryption and HMAC keys are not derived like the default behavior of the library is.</p> </div> <p>Below is a list of the available options.</p> <p>However, unless you really need to and you know what you are doing, we advise you to not change the encryption process as this could impact security, so please do so with caution.</p> <table class="docutils">  <thead valign="bottom"> <tr>
<th class="head">Option</th> <th class="head">Default value</th> <th class="head">Mandatory / Optional</th> <th class="head">Description</th> </tr> </thead>  <tr>
<td>cipher</td> <td>N/A</td> <td>Yes</td> <td>Encryption algorithm (see <a class="reference internal" href="#ciphers-and-modes"><span class="std std-ref">Supported encryption ciphers and modes</span></a>).</td> </tr> <tr>
<td>mode</td> <td>N/A</td> <td>Yes</td> <td>Encryption mode (see <a class="reference internal" href="#encryption-modes"><span class="std std-ref">Encryption modes</span></a>).</td> </tr> <tr>
<td>key</td> <td>N/A</td> <td>Yes</td> <td>Encryption key.</td> </tr> <tr>
<td>hmac</td> <td>TRUE</td> <td>No</td> <td>Whether to use a HMAC. Boolean. If set to FALSE, then <em>hmac_digest</em> and <em>hmac_key</em> will be ignored.</td> </tr> <tr>
<td>hmac_digest</td> <td>sha512</td> <td>No</td> <td>HMAC message digest algorithm (see <a class="reference internal" href="#digests"><span class="std std-ref">Supported HMAC authentication algorithms</span></a>).</td> </tr> <tr>
<td>hmac_key</td> <td>N/A</td> <td>Yes, unless <em>hmac</em> is FALSE</td> <td>HMAC key.</td> </tr> <tr>
<td>raw_data</td> <td>FALSE</td> <td>No</td> <td>Whether the cipher-text should be raw. Boolean. If set to TRUE, then Base64 encoding and decoding will not be performed and HMAC will not be a hexadecimal string.</td> </tr>  </table> <div class="admonition important"> <p class="first admonition-title">Important</p> <p class="last"><code>encrypt()</code> and <code>decrypt()</code> will return FALSE if a mandatory parameter is not provided or if a provided value is incorrect. This includes <em>hmac_key</em>, unless <em>hmac</em> is set to FALSE.</p> </div>   <h4 id="digests">Supported HMAC authentication algorithms</h4> <p id="supported-hmac-authentication-algorithms">For HMAC message authentication, the Encryption library supports usage of the SHA-2 family of algorithms:</p> <table class="docutils">  <thead valign="bottom"> <tr>
<th class="head">Algorithm</th> <th class="head">Raw length (bytes)</th> <th class="head">Hex-encoded length (bytes)</th> </tr> </thead>  <tr>
<td>sha512</td> <td>64</td> <td>128</td> </tr> <tr>
<td>sha384</td> <td>48</td> <td>96</td> </tr> <tr>
<td>sha256</td> <td>32</td> <td>64</td> </tr> <tr>
<td>sha224</td> <td>28</td> <td>56</td> </tr>  </table> <p>The reason for not including other popular algorithms, such as MD5 or SHA1 is that they are no longer considered secure enough and as such, we don’t want to encourage their usage. If you absolutely need to use them, it is easy to do so via PHP’s native <a class="reference external" href="http://php.net/manual/en/function.hash-hmac.php" target="_blank">hash_hmac()</a> function.</p> <p>Stronger algorithms of course will be added in the future as they appear and become widely available.</p>     <h2 id="class-reference">Class Reference</h2> <dl class="class"> <dt id="CI_Encryption">
<code>class CI_Encryption</code> </dt> <dd>
<dl class="method"> <dt id="CI_Encryption::initialize">
<code>initialize($params)</code> </dt> <dd>
<table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body">  <tr>
<th class="field-name">Parameters:</th>
<td class="field-body">
<ul class="first simple"> <li>
<strong>$params</strong> (<em>array</em>) – Configuration parameters</li> </ul> </td> </tr> <tr>
<th class="field-name">Returns:</th>
<td class="field-body">
<p class="first">CI_Encryption instance (method chaining)</p> </td> </tr> <tr>
<th class="field-name">Return type:</th>
<td class="field-body">
<p class="first last">CI_Encryption</p> </td> </tr>  </table> <p>Initializes (configures) the library to use a different driver, cipher, mode or key.</p> <p>Example:</p> <pre data-language="php">$this-&gt;encryption-&gt;initialize(
        array('mode' =&gt; 'ctr')
);
</pre> <p>Please refer to the <a class="reference internal" href="#configuration"><span class="std std-ref">Configuring the library</span></a> section for detailed info.</p> </dd>
</dl> <dl class="method"> <dt id="CI_Encryption::encrypt">
<code>encrypt($data[, $params = NULL])</code> </dt> <dd>
<table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body">  <tr>
<th class="field-name">Parameters:</th>
<td class="field-body">
<ul class="first simple"> <li>
<strong>$data</strong> (<em>string</em>) – Data to encrypt</li> <li>
<strong>$params</strong> (<em>array</em>) – Optional parameters</li> </ul> </td> </tr> <tr>
<th class="field-name">Returns:</th>
<td class="field-body">
<p class="first">Encrypted data or FALSE on failure</p> </td> </tr> <tr>
<th class="field-name">Return type:</th>
<td class="field-body">
<p class="first last">string</p> </td> </tr>  </table> <p>Encrypts the input data and returns its ciphertext.</p> <p>Example:</p> <pre data-language="php">$ciphertext = $this-&gt;encryption-&gt;encrypt('My secret message');
</pre> <p>Please refer to the <a class="reference internal" href="#custom-parameters"><span class="std std-ref">Using custom parameters</span></a> section for information on the optional parameters.</p> </dd>
</dl> <dl class="method"> <dt id="CI_Encryption::decrypt">
<code>decrypt($data[, $params = NULL])</code> </dt> <dd>
<table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body">  <tr>
<th class="field-name">Parameters:</th>
<td class="field-body">
<ul class="first simple"> <li>
<strong>$data</strong> (<em>string</em>) – Data to decrypt</li> <li>
<strong>$params</strong> (<em>array</em>) – Optional parameters</li> </ul> </td> </tr> <tr>
<th class="field-name">Returns:</th>
<td class="field-body">
<p class="first">Decrypted data or FALSE on failure</p> </td> </tr> <tr>
<th class="field-name">Return type:</th>
<td class="field-body">
<p class="first last">string</p> </td> </tr>  </table> <p>Decrypts the input data and returns it in plain-text.</p> <p>Example:</p> <pre data-language="php">echo $this-&gt;encryption-&gt;decrypt($ciphertext);
</pre> <p>Please refer to the <a class="reference internal" href="#custom-parameters"><span class="std std-ref">Using custom parameters</span></a> secrion for information on the optional parameters.</p> </dd>
</dl> <dl class="method"> <dt id="CI_Encryption::create_key">
<code>create_key($length)</code> </dt> <dd>
<table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body">  <tr>
<th class="field-name">Parameters:</th>
<td class="field-body">
<ul class="first simple"> <li>
<strong>$length</strong> (<em>int</em>) – Output length</li> </ul> </td> </tr> <tr>
<th class="field-name">Returns:</th>
<td class="field-body">
<p class="first">A pseudo-random cryptographic key with the specified length, or FALSE on failure</p> </td> </tr> <tr>
<th class="field-name">Return type:</th>
<td class="field-body">
<p class="first last">string</p> </td> </tr>  </table> <p>Creates a cryptographic key by fetching random data from the operating system’s sources (i.e. /dev/urandom).</p> </dd>
</dl> <dl class="method"> <dt id="CI_Encryption::hkdf">
<code>hkdf($key[, $digest = 'sha512'[, $salt = NULL[, $length = NULL[, $info = '']]]])</code> </dt> <dd>
<table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body">  <tr>
<th class="field-name">Parameters:</th>
<td class="field-body">
<ul class="first simple"> <li>
<strong>$key</strong> (<em>string</em>) – Input key material</li> <li>
<strong>$digest</strong> (<em>string</em>) – A SHA-2 family digest algorithm</li> <li>
<strong>$salt</strong> (<em>string</em>) – Optional salt</li> <li>
<strong>$length</strong> (<em>int</em>) – Optional output length</li> <li>
<strong>$info</strong> (<em>string</em>) – Optional context/application-specific info</li> </ul> </td> </tr> <tr>
<th class="field-name">Returns:</th>
<td class="field-body">
<p class="first">A pseudo-random key or FALSE on failure</p> </td> </tr> <tr>
<th class="field-name">Return type:</th>
<td class="field-body">
<p class="first last">string</p> </td> </tr>  </table> <p>Derives a key from another, presumably weaker key.</p> <p>This method is used internally to derive an encryption and HMAC key from your configured <em>encryption_key</em>.</p> <p>It is publicly available due to its otherwise general purpose. It is described in <a class="reference external" href="https://tools.ietf.org/rfc/rfc5869.txt" target="_blank">RFC 5869</a>.</p> <p>However, as opposed to the description in RFC 5869, this implementation doesn’t support SHA1.</p> <p>Example:</p> <pre data-language="php">$hmac_key = $this-&gt;encryption-&gt;hkdf(
        $key,
        'sha512',
        NULL,
        NULL,
        'authentication'
);

// $hmac_key is a pseudo-random key with a length of 64 bytes
</pre> </dd>
</dl> </dd>
</dl>
<div class="_attribution">
  <p class="_attribution-p">
    © 2014–2018 British Columbia Institute of Technology<br>Licensed under the MIT License.<br>
    <a href="https://www.codeigniter.com/user_guide/libraries/encryption.html" class="_attribution-link" target="_blank">https://www.codeigniter.com/user_guide/libraries/encryption.html</a>
  </p>
</div>

				
			</div>
			<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
</amp-auto-ads>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
