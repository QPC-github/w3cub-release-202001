
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Database Utility Class - CodeIgniter 3 - W3cubDocs</title>
  
  <meta name="description" content=" The Database Utility Class contains methods that help you manage your database. ">
  <meta name="keywords" content="database, utility, class, -, codeigniter, codeigniter~3">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/codeigniter~3/database/utilities/">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" integrity="sha256-6/DH7X+2hvUPElJfGsvzm+tgIpmM9zjbYxnpsr6gR1A=" crossorigin="anonymous" href="/assets/application-ebf0c7ed7fb686f50f12525f1acbf39beb6022998cf738db6319e9b2bea04750.css">
  <script type="text/javascript" src="/assets/application-db285287b40ed28fac520fcfd75d7d874692b647b5b5e05968c741dda5de4148.js" integrity="sha256-2yhSh7QO0o+sUg/P1119h0aStke1teBZaMdB3aXeQUg=" crossorigin="anonymous"></script>
  <script src="/json/codeigniter~3.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-2572770204602497",
            enable_page_level_ads: true
        });
  </script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/codeigniter~3/" class="_nav-link" title="" style="margin-left:0;">CodeIgniter 3</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _sphinx">
				
				
<h1 id="database-utility-class">Database Utility Class</h1> <p>The Database Utility Class contains methods that help you manage your database.</p>  <ul class="simple"> <li><a class="reference internal" href="#initializing-the-utility-class" id="id1">Initializing the Utility Class</a></li> <li>
<a class="reference internal" href="#using-the-database-utilities" id="id2">Using the Database Utilities</a><ul> <li><a class="reference internal" href="#retrieve-list-of-database-names" id="id3">Retrieve list of database names</a></li> <li><a class="reference internal" href="#determine-if-a-database-exists" id="id4">Determine If a Database Exists</a></li> <li><a class="reference internal" href="#optimize-a-table" id="id5">Optimize a Table</a></li> <li><a class="reference internal" href="#repair-a-table" id="id6">Repair a Table</a></li> <li><a class="reference internal" href="#optimize-a-database" id="id7">Optimize a Database</a></li> <li><a class="reference internal" href="#export-a-query-result-as-a-csv-file" id="id8">Export a Query Result as a CSV File</a></li> <li><a class="reference internal" href="#export-a-query-result-as-an-xml-document" id="id9">Export a Query Result as an XML Document</a></li> </ul> </li> <li>
<a class="reference internal" href="#backup-your-database" id="id10">Backup Your Database</a><ul> <li><a class="reference internal" href="#database-backup-notes" id="id11">Database Backup Notes</a></li> <li><a class="reference internal" href="#usage-example" id="id12">Usage Example</a></li> <li><a class="reference internal" href="#setting-backup-preferences" id="id13">Setting Backup Preferences</a></li> <li><a class="reference internal" href="#description-of-backup-preferences" id="id14">Description of Backup Preferences</a></li> </ul> </li> <li><a class="reference internal" href="#class-reference" id="id15">Class Reference</a></li> </ul>   <h2 id="initializing-the-utility-class">Initializing the Utility Class</h2> <div class="admonition important"> <p class="first admonition-title">Important</p> <p class="last">In order to initialize the Utility class, your database driver must already be running, since the utilities class relies on it.</p> </div> <p>Load the Utility Class as follows:</p> <pre data-language="php">$this-&gt;load-&gt;dbutil();
</pre> <p>You can also pass another database object to the DB Utility loader, in case the database you want to manage isn’t the default one:</p> <pre data-language="php">$this-&gt;myutil = $this-&gt;load-&gt;dbutil($this-&gt;other_db, TRUE);
</pre> <p>In the above example, we’re passing a custom database object as the first parameter and then tell it to return the dbutil object, instead of assigning it directly to <code>$this-&gt;dbutil</code>.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Both of the parameters can be used individually, just pass an empty value as the first one if you wish to skip it.</p> </div> <p>Once initialized you will access the methods using the <code>$this-&gt;dbutil</code> object:</p> <pre data-language="php">$this-&gt;dbutil-&gt;some_method();
</pre>   <h2 id="using-the-database-utilities">Using the Database Utilities</h2>  <h3 id="retrieve-list-of-database-names">Retrieve list of database names</h3> <p>Returns an array of database names:</p> <pre data-language="php">$dbs = $this-&gt;dbutil-&gt;list_databases();

foreach ($dbs as $db)
{
        echo $db;
}
</pre>   <h3 id="determine-if-a-database-exists">Determine If a Database Exists</h3> <p>Sometimes it’s helpful to know whether a particular database exists. Returns a boolean TRUE/FALSE. Usage example:</p> <pre data-language="php">if ($this-&gt;dbutil-&gt;database_exists('database_name'))
{
        // some code...
}
</pre> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Replace <em>database_name</em> with the name of the database you are looking for. This method is case sensitive.</p> </div>   <h3 id="optimize-a-table">Optimize a Table</h3> <p>Permits you to optimize a table using the table name specified in the first parameter. Returns TRUE/FALSE based on success or failure:</p> <pre data-language="php">if ($this-&gt;dbutil-&gt;optimize_table('table_name'))
{
        echo 'Success!';
}
</pre> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Not all database platforms support table optimization. It is mostly for use with MySQL.</p> </div>   <h3 id="repair-a-table">Repair a Table</h3> <p>Permits you to repair a table using the table name specified in the first parameter. Returns TRUE/FALSE based on success or failure:</p> <pre data-language="php">if ($this-&gt;dbutil-&gt;repair_table('table_name'))
{
        echo 'Success!';
}
</pre> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Not all database platforms support table repairs.</p> </div>   <h3 id="optimize-a-database">Optimize a Database</h3> <p>Permits you to optimize the database your DB class is currently connected to. Returns an array containing the DB status messages or FALSE on failure.</p> <pre data-language="php">$result = $this-&gt;dbutil-&gt;optimize_database();

if ($result !== FALSE)
{
        print_r($result);
}
</pre> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Not all database platforms support database optimization. It it is mostly for use with MySQL.</p> </div>   <h3 id="export-a-query-result-as-a-csv-file">Export a Query Result as a CSV File</h3> <p>Permits you to generate a CSV file from a query result. The first parameter of the method must contain the result object from your query. Example:</p> <pre data-language="php">$this-&gt;load-&gt;dbutil();

$query = $this-&gt;db-&gt;query("SELECT * FROM mytable");

echo $this-&gt;dbutil-&gt;csv_from_result($query);
</pre> <p>The second, third, and fourth parameters allow you to set the delimiter newline, and enclosure characters respectively. By default commas are used as the delimiter, “n” is used as a new line, and a double-quote is used as the enclosure. Example:</p> <pre data-language="php">$delimiter = ",";
$newline = "\r\n";
$enclosure = '"';

echo $this-&gt;dbutil-&gt;csv_from_result($query, $delimiter, $newline, $enclosure);
</pre> <div class="admonition important"> <p class="first admonition-title">Important</p> <p class="last">This method will NOT write the CSV file for you. It simply creates the CSV layout. If you need to write the file use the <a class="reference internal" href="../../helpers/file_helper/"><span class="doc">File Helper</span></a>.</p> </div>   <h3 id="export-a-query-result-as-an-xml-document">Export a Query Result as an XML Document</h3> <p>Permits you to generate an XML file from a query result. The first parameter expects a query result object, the second may contain an optional array of config parameters. Example:</p> <pre data-language="php">$this-&gt;load-&gt;dbutil();

$query = $this-&gt;db-&gt;query("SELECT * FROM mytable");

$config = array (
        'root'          =&gt; 'root',
        'element'       =&gt; 'element',
        'newline'       =&gt; "\n",
        'tab'           =&gt; "\t"
);

echo $this-&gt;dbutil-&gt;xml_from_result($query, $config);
</pre> <div class="admonition important"> <p class="first admonition-title">Important</p> <p class="last">This method will NOT write the XML file for you. It simply creates the XML layout. If you need to write the file use the <a class="reference internal" href="../../helpers/file_helper/"><span class="doc">File Helper</span></a>.</p> </div>    <h2 id="backup-your-database">Backup Your Database</h2>  <h3 id="database-backup-notes">Database Backup Notes</h3> <p>Permits you to backup your full database or individual tables. The backup data can be compressed in either Zip or Gzip format.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">This feature is only available for MySQL and Interbase/Firebird databases.</p> </div> <div class="admonition note"> <p class="first admonition-title">Note</p> <p>For Interbase/Firebird databases, the backup file name is the only parameter.</p> <p class="last">$this-&gt;dbutil-&gt;backup(‘db_backup_filename’);</p> </div> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Due to the limited execution time and memory available to PHP, backing up very large databases may not be possible. If your database is very large you might need to backup directly from your SQL server via the command line, or have your server admin do it for you if you do not have root privileges.</p> </div>   <h3 id="usage-example">Usage Example</h3> <pre data-language="php">// Load the DB utility class
$this-&gt;load-&gt;dbutil();

// Backup your entire database and assign it to a variable
$backup = $this-&gt;dbutil-&gt;backup();

// Load the file helper and write the file to your server
$this-&gt;load-&gt;helper('file');
write_file('/path/to/mybackup.gz', $backup);

// Load the download helper and send the file to your desktop
$this-&gt;load-&gt;helper('download');
force_download('mybackup.gz', $backup);
</pre>   <h3 id="setting-backup-preferences">Setting Backup Preferences</h3> <p>Backup preferences are set by submitting an array of values to the first parameter of the <code>backup()</code> method. Example:</p> <pre data-language="php">$prefs = array(
        'tables'        =&gt; array('table1', 'table2'),   // Array of tables to backup.
        'ignore'        =&gt; array(),                     // List of tables to omit from the backup
        'format'        =&gt; 'txt',                       // gzip, zip, txt
        'filename'      =&gt; 'mybackup.sql',              // File name - NEEDED ONLY WITH ZIP FILES
        'add_drop'      =&gt; TRUE,                        // Whether to add DROP TABLE statements to backup file
        'add_insert'    =&gt; TRUE,                        // Whether to add INSERT data to backup file
        'newline'       =&gt; "\n"                         // Newline character used in backup file
);

$this-&gt;dbutil-&gt;backup($prefs);
</pre>   <h3 id="description-of-backup-preferences">Description of Backup Preferences</h3> <table class="docutils">  <thead valign="bottom"> <tr>
<th class="head">Preference</th> <th class="head">Default Value</th> <th class="head">Options</th> <th class="head">Description</th> </tr> </thead>  <tr>
<td><strong>tables</strong></td> <td>empty array</td> <td>None</td> <td>An array of tables you want backed up. If left blank all tables will be exported.</td> </tr> <tr>
<td><strong>ignore</strong></td> <td>empty array</td> <td>None</td> <td>An array of tables you want the backup routine to ignore.</td> </tr> <tr>
<td><strong>format</strong></td> <td>gzip</td> <td>gzip, zip, txt</td> <td>The file format of the export file.</td> </tr> <tr>
<td><strong>filename</strong></td> <td>the current date/time</td> <td>None</td> <td>The name of the backed-up file. The name is needed only if you are using zip compression.</td> </tr> <tr>
<td><strong>add_drop</strong></td> <td>TRUE</td> <td>TRUE/FALSE</td> <td>Whether to include DROP TABLE statements in your SQL export file.</td> </tr> <tr>
<td><strong>add_insert</strong></td> <td>TRUE</td> <td>TRUE/FALSE</td> <td>Whether to include INSERT statements in your SQL export file.</td> </tr> <tr>
<td><strong>newline</strong></td> <td>“\n”</td> <td>“\n”, “\r”, “\r\n”</td> <td>Type of newline to use in your SQL export file.</td> </tr> <tr>
<td><strong>foreign_key_checks</strong></td> <td>TRUE</td> <td>TRUE/FALSE</td> <td>Whether output should keep foreign key checks enabled.</td> </tr>  </table>    <h2 id="class-reference">Class Reference</h2> <dl class="class"> <dt id="CI_DB_utility">
<code>class CI_DB_utility</code> </dt> <dd>
<dl class="method"> <dt id="CI_DB_utility::backup">
<code>backup([$params = array()])</code> </dt> <dd>
<table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body">  <tr>
<th class="field-name">Parameters:</th>
<td class="field-body">
<ul class="first simple"> <li>
<strong>$params</strong> (<em>array</em>) – An associative array of options</li> </ul> </td> </tr> <tr>
<th class="field-name">Returns:</th>
<td class="field-body">
<p class="first">raw/(g)zipped SQL query string</p> </td> </tr> <tr>
<th class="field-name">Return type:</th>
<td class="field-body">
<p class="first last">string</p> </td> </tr>  </table> <p>Perform a database backup, per user preferences.</p> </dd>
</dl> <dl class="method"> <dt id="CI_DB_utility::database_exists">
<code>database_exists($database_name)</code> </dt> <dd>
<table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body">  <tr>
<th class="field-name">Parameters:</th>
<td class="field-body">
<ul class="first simple"> <li>
<strong>$database_name</strong> (<em>string</em>) – Database name</li> </ul> </td> </tr> <tr>
<th class="field-name">Returns:</th>
<td class="field-body">
<p class="first">TRUE if the database exists, FALSE otherwise</p> </td> </tr> <tr>
<th class="field-name">Return type:</th>
<td class="field-body">
<p class="first last">bool</p> </td> </tr>  </table> <p>Check for the existence of a database.</p> </dd>
</dl> <dl class="method"> <dt id="CI_DB_utility::list_databases">
<code>list_databases()</code> </dt> <dd>
<table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body">  <tr>
<th class="field-name">Returns:</th>
<td class="field-body">Array of database names found</td> </tr> <tr>
<th class="field-name">Return type:</th>
<td class="field-body">array</td> </tr>  </table> <p>Retrieve a list of all the database names.</p> </dd>
</dl> <dl class="method"> <dt id="CI_DB_utility::optimize_database">
<code>optimize_database()</code> </dt> <dd>
<table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body">  <tr>
<th class="field-name">Returns:</th>
<td class="field-body">Array of optimization messages or FALSE on failure</td> </tr> <tr>
<th class="field-name">Return type:</th>
<td class="field-body">array</td> </tr>  </table> <p>Optimizes the database.</p> </dd>
</dl> <dl class="method"> <dt id="CI_DB_utility::optimize_table">
<code>optimize_table($table_name)</code> </dt> <dd>
<table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body">  <tr>
<th class="field-name">Parameters:</th>
<td class="field-body">
<ul class="first simple"> <li>
<strong>$table_name</strong> (<em>string</em>) – Name of the table to optimize</li> </ul> </td> </tr> <tr>
<th class="field-name">Returns:</th>
<td class="field-body">
<p class="first">Array of optimization messages or FALSE on failure</p> </td> </tr> <tr>
<th class="field-name">Return type:</th>
<td class="field-body">
<p class="first last">array</p> </td> </tr>  </table> <p>Optimizes a database table.</p> </dd>
</dl> <dl class="method"> <dt id="CI_DB_utility::repair_table">
<code>repair_table($table_name)</code> </dt> <dd>
<table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body">  <tr>
<th class="field-name">Parameters:</th>
<td class="field-body">
<ul class="first simple"> <li>
<strong>$table_name</strong> (<em>string</em>) – Name of the table to repair</li> </ul> </td> </tr> <tr>
<th class="field-name">Returns:</th>
<td class="field-body">
<p class="first">Array of repair messages or FALSE on failure</p> </td> </tr> <tr>
<th class="field-name">Return type:</th>
<td class="field-body">
<p class="first last">array</p> </td> </tr>  </table> <p>Repairs a database table.</p> </dd>
</dl> <dl class="method"> <dt id="CI_DB_utility::csv_from_result">
<code>csv_from_result($query[, $delim = ', '[, $newline = "n"[, $enclosure = '"']]])</code> </dt> <dd>
<table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body">  <tr>
<th class="field-name">Parameters:</th>
<td class="field-body">
<ul class="first simple"> <li>
<strong>$query</strong> (<em>object</em>) – A database result object</li> <li>
<strong>$delim</strong> (<em>string</em>) – The CSV field delimiter to use</li> <li>
<strong>$newline</strong> (<em>string</em>) – The newline character to use</li> <li>
<strong>$enclosure</strong> (<em>string</em>) – The enclosure delimiter to use</li> </ul> </td> </tr> <tr>
<th class="field-name">Returns:</th>
<td class="field-body">
<p class="first">The generated CSV file as a string</p> </td> </tr> <tr>
<th class="field-name">Return type:</th>
<td class="field-body">
<p class="first last">string</p> </td> </tr>  </table> <p>Translates a database result object into a CSV document.</p> </dd>
</dl> <dl class="method"> <dt id="CI_DB_utility::xml_from_result">
<code>xml_from_result($query[, $params = array()])</code> </dt> <dd>
<table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body">  <tr>
<th class="field-name">Parameters:</th>
<td class="field-body">
<ul class="first simple"> <li>
<strong>$query</strong> (<em>object</em>) – A database result object</li> <li>
<strong>$params</strong> (<em>array</em>) – An associative array of preferences</li> </ul> </td> </tr> <tr>
<th class="field-name">Returns:</th>
<td class="field-body">
<p class="first">The generated XML document as a string</p> </td> </tr> <tr>
<th class="field-name">Return type:</th>
<td class="field-body">
<p class="first last">string</p> </td> </tr>  </table> <p>Translates a database result object into an XML document.</p> </dd>
</dl> </dd>
</dl>
<div class="_attribution">
  <p class="_attribution-p">
    © 2014–2018 British Columbia Institute of Technology<br>Licensed under the MIT License.<br>
    <a href="https://www.codeigniter.com/user_guide/database/utilities.html" class="_attribution-link" target="_blank">https://www.codeigniter.com/user_guide/database/utilities.html</a>
  </p>
</div>

				
			</div>
			<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
</amp-auto-ads>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
