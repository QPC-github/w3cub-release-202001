
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Server - Cypress - W3cubDocs</title>
  
  <meta name="description" content=" Start a server to begin routing responses to cy.route() and cy.request(). ">
  <meta name="keywords" content="server, syntax, examples, notes, rules, command, log, history, see, also, -, cypress">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/cypress/api/commands/server/">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" integrity="sha256-6/DH7X+2hvUPElJfGsvzm+tgIpmM9zjbYxnpsr6gR1A=" crossorigin="anonymous" href="/assets/application-ebf0c7ed7fb686f50f12525f1acbf39beb6022998cf738db6319e9b2bea04750.css">
  <script type="text/javascript" src="/assets/application-db285287b40ed28fac520fcfd75d7d874692b647b5b5e05968c741dda5de4148.js" integrity="sha256-2yhSh7QO0o+sUg/P1119h0aStke1teBZaMdB3aXeQUg=" crossorigin="anonymous"></script>
  <script src="/json/cypress.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-2572770204602497",
            enable_page_level_ads: true
        });
  </script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/cypress/" class="_nav-link" title="" style="margin-left:0;">Cypress</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _cypress">
				
				
<h1 class="article-title" itemprop="name">server</h1>  <div class="article-content" itemprop="articleBody"> <p>Start a server to begin routing responses to <a href="../route/"><code>cy.route()</code></a> and <a href="../request/"><code>cy.request()</code></a>.</p> <blockquote class="note info">
<p><strong>Note:</strong> <code>cy.server()</code> assumes you are already familiar with core concepts such as <a href="../../../guides/guides/network-requests/">network requests</a>.</p> </blockquote> <blockquote class="note warning">
<p>Please be aware that Cypress only currently supports intercepting XMLHttpRequests. Requests using the Fetch API and other types of network requests like page loads and <code>&lt;script&gt;</code> tags will not be intercepted or visible in the Command Log. See <a href="https://github.com/cypress-io/cypress/issues/95" target="_blank" rel="noopener noreferrer">#95</a> for more details and temporary workarounds.</p>
<br>
</blockquote> <h1 id="Syntax" class="article-heading">
Syntax
</h1>
<pre class=" language-javascript" data-language="javascript">cy.server()
cy.server(options)
</pre> <h2 id="Usage" class="article-heading">
Usage
</h2>
<p><strong> Correct Usage</strong></p> <pre class=" language-javascript" data-language="javascript">cy.server()
</pre> <h2 id="Arguments" class="article-heading">
Arguments
</h2>
<p><strong> options</strong> <strong><em>(Object)</em></strong></p> <p>Pass in an options object to change the default behavior of <code>cy.server()</code>. These options are used for 2 different purposes:</p> <ul> <li>As defaults that are merged into <a href="../route/"><code>cy.route()</code></a>.</li> <li>As configuration behavior for <em>all</em> requests.</li> </ul> <h3 id="The-following-options-are-merged-in-as-default-options-to" class="article-heading">
The following options are merged in as default options to <a href="../route/"><code>cy.route()</code></a>
</h3>
<table> <thead> <tr> <th>Option</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>delay</code></td> <td><code>0</code></td> <td>delay for stubbed responses (in ms)</td> </tr> <tr> <td><code>headers</code></td> <td><code>null</code></td> <td>response headers for stubbed routes</td> </tr> <tr> <td><code>method</code></td> <td><code>"GET"</code></td> <td>method to match against requests</td> </tr> <tr> <td><code>onAbort</code></td> <td><code>undefined</code></td> <td>callback function which fires anytime an XHR is aborted</td> </tr> <tr> <td><code>onRequest</code></td> <td><code>undefined</code></td> <td>callback function when a request is sent</td> </tr> <tr> <td><code>onResponse</code></td> <td><code>undefined</code></td> <td>callback function when a response is returned</td> </tr> <tr> <td><code>response</code></td> <td><code>null</code></td> <td>response body when stubbing routes</td> </tr> <tr> <td><code>status</code></td> <td><code>200</code></td> <td>response status code when stubbing routes</td> </tr> </tbody> </table> <h3 id="The-following-options-control-the-behavior-of-the-server-affecting-all-requests" class="article-heading">
The following options control the behavior of the server affecting all requests
</h3>
<table> <thead> <tr> <th>Option</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>enable</code></td> <td><code>true</code></td> <td>pass <code>false</code> to disable existing route stubs</td> </tr> <tr> <td><code>force404</code></td> <td><code>false</code></td> <td>forcibly send XHR’s a 404 status when the XHR’s do not match any existing route</td> </tr> <tr> <td><code>onAnyAbort</code></td> <td><code>undefined</code></td> <td>callback function called when any XHR is aborted</td> </tr> <tr> <td><code>onAnyRequest</code></td> <td><code>undefined</code></td> <td>callback function called when any request is sent</td> </tr> <tr> <td><code>onAnyResponse</code></td> <td><code>undefined</code></td> <td>callback function called when any response is returned</td> </tr> <tr> <td><code>urlMatchingOptions</code></td> <td><code>{ matchBase: true }</code></td> <td>The default options passed to <code>minimatch</code> when using glob strings to match URLs</td> </tr> <tr> <td><code>whitelist</code></td> <td>function</td> <td>Callback function that whitelists requests from ever being logged or stubbed. By default this matches against asset-like requests such as for <code>.js</code>, <code>.jsx</code>, <code>.html</code>, and <code>.css</code> files.</td> </tr> </tbody> </table> <h2 id="Yields" class="article-heading">
Yields 
</h2>
<ul> <li><p><code>cy.server()</code> yields <code>null</code>.</p></li> <li><p><code>cy.server()</code> cannot be chained further.</p></li> </ul> <h1 id="Examples" class="article-heading">
Examples
</h1>
<h2 id="No-Args" class="article-heading">
No Args
</h2>
<h3 id="After-starting-a-server" class="article-heading">
After starting a server:
</h3>
<ul> <li>Any request that does <strong>NOT</strong> match a <a href="../route/"><code>cy.route()</code></a> will <a href="#">pass through to the server</a>.</li> <li>Any request that matches the <code>options.whitelist</code> function will <strong>NOT</strong> be logged or stubbed. In other words it is “whitelisted” and ignored.</li> <li>You will see requests named as <code>(XHR Stub)</code> or <code>(XHR)</code> in the Command Log.</li> </ul> <pre class=" language-javascript" data-language="javascript">cy.server()
</pre> <h2 id="Options" class="article-heading">
Options
</h2>
<h3 id="Change-defaults-for" class="article-heading">
Change defaults for <a href="../route/"><code>cy.route()</code></a>
</h3>
<p>By default <a href="../route/"><code>cy.route()</code></a> inherits some of its options from <code>cy.server()</code>.</p> <p>In this example, our matching requests will be delayed 1000ms and have a status of <code>422</code>, but its <code>response</code> will be what was set in <a href="../route/"><code>cy.route()</code></a>.</p> <pre class=" language-javascript" data-language="javascript">cy.server({
  method: 'POST',
  delay: 1000,
  status: 422,
  response: {}
})

cy.route('/users/', { errors: 'Name cannot be blank' })
</pre> <h3 id="Change-the-default-delay-for-all-routes" class="article-heading">
Change the default delay for all routes
</h3>
<p>Adding delay can help simulate real world network latency. Normally stubbed responses return in under 20ms. Adding a delay can help you visualize how your application’s state reacts to requests that are in flight.</p> <pre class=" language-javascript" data-language="javascript">// delay each route's response 1500ms
cy.server({ delay: 1500 })
</pre> <h3 id="Send-404s-on-unmatched-requests" class="article-heading">
Send 404s on unmatched requests
</h3>
<p>If you’d like Cypress to automatically send requests that do <em>NOT</em> match routes the following response:</p> <table> <thead> <tr> <th>Status</th> <th>Body</th> <th>Headers</th> </tr> </thead> <tbody> <tr> <td><code>404</code></td> <td>“”</td> <td><code>null</code></td> </tr> </tbody> </table> <p>Set <code>force404</code> to <code>true</code>.</p> <pre class=" language-javascript" data-language="javascript">cy.server({ force404: true })
cy.route('/activities/**', 'fixture:activities.json')
</pre> <pre class=" language-javascript" data-language="javascript">// Application Code
$(function () {
  $.get('/activities')

  // this will be sent back 404 since it
  // does not match any of the cy.routes
  $.getJSON('/users.json')
})
</pre> <h3 id="Change-the-default-response-headers-for-all-routes" class="article-heading">
Change the default response headers for all routes
</h3>
<p>When you stub requests, you can automatically control their response <code>headers</code>. This is useful when you want to send back meta data in the <code>headers</code>, such as <em>pagination</em> or <em>token</em> information.</p> <blockquote class="note info">
<p>Cypress automatically sets <code>Content-Length</code> and <code>Content-Type</code> based on the response <code>body</code> you stub.</p> </blockquote> <pre class=" language-javascript" data-language="javascript">cy.server({
  headers: {
    'x-token': 'abc-123-foo-bar'
  }
})
cy.route('GET', '/users/1', { id: 1, name: 'Amanda' }).as('getUser')
cy.visit('/users/1/profile')
cy.wait('@getUser').its('responseHeaders')
  .should('have.property', 'x-token', 'abc-123-foo-bar') // true
</pre> <pre class=" language-javascript" data-language="javascript">// Application Code

// lets use the native XHR object
const xhr = new XMLHttpRequest

xhr.open('GET', '/users/1')

xhr.onload = function () {
  const token = this.getResponseHeader('x-token')

  console.log(token) // =&gt; abc-123-foo-bar
}

xhr.send()
</pre> <h3 id="Set-a-custom-request-header-for-all-requests" class="article-heading">
Set a custom request header for all requests
</h3>
<pre class=" language-js" data-language="javascript">cy.server({
  onAnyRequest: (route,  proxy) =&gt; {
    proxy.xhr.setRequestHeader('CUSTOM-HEADER',  'Header value')
  }
})
</pre> <h3 id="Change-the-default-whitelisting" class="article-heading">
Change the default whitelisting
</h3>
<p><code>cy.server()</code> comes with a <code>whitelist</code> function that by default filters out any requests that are for static assets like <code>.html</code>, <code>.js</code>, <code>.jsx</code>, and <code>.css</code>.</p> <p>Any request that passes the <code>whitelist</code> will be ignored - it will not be logged nor will it be stubbed in any way (even if it matches a specific <a href="../route/"><code>cy.route()</code></a>).</p> <p>The idea is that we never want to interfere with static assets that are fetched via Ajax.</p> <p><strong>The default whitelist function in Cypress is:</strong></p> <pre class=" language-javascript" data-language="javascript">const whitelist = (xhr) =&gt; {
  // this function receives the xhr object in question and
  // will whitelist if it's a GET that appears to be a static resource
  return xhr.method === 'GET' &amp;&amp; /\.(jsx?|html|css)(\?.*)?$/.test(xhr.url)
}
</pre> <p><strong>You can override this function with your own specific logic:</strong></p> <pre class=" language-javascript" data-language="javascript">cy.server({
  whitelist: (xhr) =&gt; {
    // specify your own function that should return
    // truthy if you want this xhr to be ignored,
    // not logged, and not stubbed.
  }
})
</pre> <p>If you would like to change the default option for <strong>ALL</strong> <code>cy.server()</code> you <a href="../../cypress-api/cypress-server/#Options">can change this option permanently</a>.</p> <h3 id="Turn-off-the-server-after-you’ve-started-it" class="article-heading">
Turn off the server after you’ve started it
</h3>
<p>You can disable all stubbing and its effects and restore it to the default behavior as a test is running. By setting <code>enable</code> to <code>false</code>, this disables stubbing routes and XHR’s will no longer show up as (XHR Stub) in the Command Log. However, routing aliases can continue to be used and will continue to match requests, but will not affect responses.</p> <pre class=" language-javascript" data-language="javascript">cy.server()
cy.route('POST', '/users', {}).as('createUser')
cy.server({ enable: false })
</pre> <h1 id="Notes" class="article-heading">
Notes
</h1>
<p><strong><em>Server persists until the next test runs</em></strong></p> <p>Cypress automatically continues to persist the server and routing configuration even after a test ends. This means you can continue to use your application and still benefit from stubbing or other server configuration.</p> <p>However between tests, when a new test runs, the previous configuration is restored to a clean state. No configuration leaks between tests.</p> <p><strong><em>Outstanding requests are automatically aborted between tests</em></strong></p> <p>When a new test runs, any outstanding requests still in flight are automatically aborted. In fact this happens by default whether or not you’ve even started a <code>cy.server()</code>.</p> <p><strong><em>Server can be started before you <a href="../visit/"><code>cy.visit()</code></a></em></strong></p> <p>Oftentimes your application may make initial requests immediately when it loads (such as authenticating a user). Cypress makes it possible to start your server and define routes before a <a href="../visit/"><code>cy.visit()</code></a>. Upon the next visit, the server + routes will be instantly applied before your application loads.</p> <p>You can <a href="../../../guides/guides/network-requests/">read more about XHR strategy here</a>.</p> <h1 id="Rules" class="article-heading">
Rules
</h1>
<h2 id="Requirements" class="article-heading">
Requirements 
</h2>
<ul> <li><p><code>cy.server()</code> requires being chained off of <code>cy</code>.</p></li> </ul> <h2 id="Assertions" class="article-heading">
Assertions 
</h2>
<ul> <li><p><code>cy.server()</code> cannot have any assertions chained.</p></li> </ul> <h2 id="Timeouts" class="article-heading">
Timeouts 
</h2>
<ul> <li><p><code>cy.server()</code> cannot time out.</p></li> </ul> <h1 id="Command-Log" class="article-heading">
Command Log
</h1>
<ul> <li>
<code>cy.server()</code> does <em>not</em> log in the Command Log</li> </ul> <details class="history"><summary><h1 id="History" class="article-heading">
History
</h1></summary><table> <thead> <tr> <th>Version</th> <th>Changes</th> </tr> </thead> <tbody> <tr> <td><a href="../../../guides/references/changelog/#0-13-6">0.13.6</a></td> <td>Added <code>onAbort</code> callback option</td> </tr> <tr> <td><a href="../../../guides/references/changelog/#0-5-10">0.5.10</a></td> <td>Added <code>delay</code> option</td> </tr> <tr> <td><a href="../../../guides/references/changelog/#0-3-3">0.3.3</a></td> <td>Added <code>whitelist</code> option</td> </tr> <tr> <td><a href="../../../guides/references/changelog/#0-3-3">&lt; 0.3.3</a></td> <td>
<code>cy.server()</code> command added</td> </tr> </tbody> </table> </details> <h1 id="See-also" class="article-heading">
See also
</h1>
<ul> <li><a href="../../../guides/guides/network-requests/">Network Requests</a></li> <li><a href="../request/"><code>cy.request()</code></a></li> <li><a href="../route/"><code>cy.route()</code></a></li> <li><a href="../visit/"><code>cy.visit()</code></a></li> <li>
<a href="../wait/"><code>cy.wait()</code></a> </li> </ul> </div>
<div class="_attribution">
  <p class="_attribution-p">
    © 2017 Cypress.io<br>Licensed under the MIT License.<br>
    <a href="https://docs.cypress.io/api/commands/server.html" class="_attribution-link" target="_blank">https://docs.cypress.io/api/commands/server.html</a>
  </p>
</div>

				
			</div>
			<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
</amp-auto-ads>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
